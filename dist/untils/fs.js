"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("fs"),t=require("util"),r=require("path"),n=require("./format"),s=require("path");exports.existsSync=t=>e.existsSync(t);const i=t.promisify(e.mkdir);exports.mkdirAsync=i,exports.mkdirAsyncRecursive=async e=>{await i(e,{recursive:!0})},exports.symlinkAsync=t.promisify(e.symlink);const o=t.promisify(e.readFile);async function c(e){if(!e)return!1;const t=await exports.lstatAsync(e);if(t.isFile())return console.log("is file"),!1;if(t.isDirectory()){const t=await exports.readdirAsync(e);return 1===t.length&&".DS_Store"===t[0]||0===t.length}return!1}function a(t,r=!0){t=r?t:s.join(__dirname,t);try{e.existsSync(t)?e.unlinkSync(t):console.log("inexistence pathï¼š",t)}catch(e){console.log("del error",e)}}function y(t,r=!0){r||(t=s.join(__dirname,t));try{if(e.existsSync(t)){const r=function(t){const n=e.readdirSync(t);for(let i=0;i<n.length;i++){const o=s.join(t,n[i]);e.statSync(o).isDirectory()?r(o):a(o,!0)}e.rmdirSync(t)};r(t)}else console.log("do not exist: ",t)}catch(e){console.log("del folder error",e)}}function l(t,r,n=!0){if(n||(t=s.join(__dirname,t),r=s.join(__dirname,r)),e.existsSync(t)){i=r,e.existsSync(i)||e.mkdirSync(i);const n=e.readdirSync(t,{withFileTypes:!0});for(let i=0;i<n.length;i++){const o=n[i],c=s.join(t,o.name),a=s.join(r,o.name);if(o.isFile()){const t=e.createReadStream(c),r=e.createWriteStream(a);t.pipe(r)}else try{e.accessSync(s.join(a,".."),e.constants.W_OK),l(c,a,!0)}catch(e){console.log("folder write error:",e)}}}else console.log("do not exist path: ",t);var i}exports.readFileAsync=o,exports.readFileContentAsync=async e=>await o(e,{encoding:"utf8"}),exports.writeFileAsync=t.promisify(e.writeFile),exports.readdirAsync=t.promisify(e.readdir),exports.statAsync=t.promisify(e.stat),exports.lstatAsync=t.promisify(e.lstat),exports.renameAsync=t.promisify(e.rename),exports.unlinkSync=t.promisify(e.unlinkSync),exports.replaceContent=async(r,n,s)=>{if(!r)return;const i=t.promisify(e.readFile),o=await i(r,{encoding:"utf8"}),c=new RegExp(n,"g"),a=o.replace(c,s),y=t.promisify(e.writeFile);await y(r,a,{encoding:"utf8"})},exports.existsAsync=async e=>{try{await exports.statAsync(e);return!0}catch(e){return!1}},exports.convertToUnixPath=e=>e.replace(/\\/g,"/"),exports.directoryIsEmpty=c,exports.deleteFile=a,exports.syncDeleteFolder=y,exports.syncCopyFolder=l;const p=e=>{if(!e)return"0M";return`${(e/1e6).toFixed(2)}M`};async function d(e,t,s=!1){if(!e||!t)throw new Error("Missing Path Or Extname");const i=[],o=e,c=async(e,t)=>{for(var a=await exports.readdirAsync(e),y=0;y<a.length;y++){const l=a[y],d=r.join(e,l),f=await exports.lstatAsync(d);if(f.isDirectory()){if("node_modules"===l&&s)continue;await c(d,t)}else if(f.isFile()){const e=()=>{const e=n.formatDate(parseInt(f.atimeMs),"yyyy-MM-dd hh:mm:ss"),t={name:l,time:e,fullPath:d,shortPath:d.replace(o,""),size:p(f.size)};i.push(t)};if(t instanceof Array){t.find((e=>e==r.extname(d)))&&e()}else t===r.extname(d)&&e()}}};return await c(e,t),i}exports.findFiles=d;