"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("fs"),t=require("util"),r=require("path"),i=require("./format"),s=require("path");async function n(e){if(!e)return!1;const t=await exports.lstatAsync(e);if(t.isFile())return console.log("is file"),!1;if(t.isDirectory()){const t=await exports.readdirAsync(e);return 1===t.length&&".DS_Store"===t[0]||0===t.length}return!1}function o(t,r){t=r?t:s.join(__dirname,t);try{e.existsSync(t)?e.unlinkSync(t):console.log("inexistence pathï¼š",t)}catch(e){console.log("del error",e)}}function c(t,r=!0){r||(t=s.join(__dirname,t));try{if(e.existsSync(t)){const r=function(t){const i=e.readdirSync(t);for(let n=0;n<i.length;n++){const c=s.join(t,i[n]);e.statSync(c).isDirectory()?r(c):o(c,!0)}e.rmdirSync(t)};r(t)}else console.log("do not exist: ",t)}catch(e){console.log("del folder error",e)}}function a(t,r,i=!0){if(i||(t=s.join(__dirname,t),r=s.join(__dirname,r)),e.existsSync(t)){n=r,e.existsSync(n)||e.mkdirSync(n);const i=e.readdirSync(t,{withFileTypes:!0});for(let n=0;n<i.length;n++){const o=i[n],c=s.join(t,o.name),l=s.join(r,o.name);if(o.isFile()){const t=e.createReadStream(c),r=e.createWriteStream(l);t.pipe(r)}else try{e.accessSync(s.join(l,".."),e.constants.W_OK),a(c,l,!0)}catch(e){console.log("folder write error:",e)}}}else console.log("do not exist path: ",t);var n}async function l(e,t,s=!1){if(!e||!t)throw new Error("Missing Path Or Extname");const n=[],o=e,c=async(e,t)=>{for(var a=await exports.readdirAsync(e),l=0;l<a.length;l++){const y=a[l],p=r.join(e,y),d=await exports.lstatAsync(p);if(d.isDirectory()){if("node_modules"===y&&s)continue;await c(p,t)}else if(d.isFile()&&t===r.extname(p)){const e={name:y,time:i.formatDate(parseInt(d.birthtimeMs),"yyyy-MM-dd hh:mm:ss"),fullPath:p,shortPath:p.replace(o,"")};n.push(e)}}};return await c(e,t),n}exports.existsSync=t=>e.existsSync(t),exports.mkdirAsync=t.promisify(e.mkdir),exports.symlinkAsync=t.promisify(e.symlink),exports.readFileAsync=t.promisify(e.readFile),exports.writeFileAsync=t.promisify(e.writeFile),exports.readdirAsync=t.promisify(e.readdir),exports.statAsync=t.promisify(e.stat),exports.lstatAsync=t.promisify(e.lstat),exports.renameAsync=t.promisify(e.rename),exports.replaceContent=async(r,i,s)=>{if(!r)return;const n=t.promisify(e.readFile),o=await n(r,{encoding:"utf8"}),c=new RegExp(i,"g"),a=o.replace(c,s),l=t.promisify(e.writeFile);await l(r,a,{encoding:"utf8"})},exports.existsAsync=async e=>{try{await exports.statAsync(e);return!0}catch(e){return!1}},exports.convertToUnixPath=e=>e.replace(/\\/g,"/"),exports.directoryIsEmpty=n,exports.deleteFile=o,exports.syncDeleteFolder=c,exports.syncCopyFolder=a,exports.findFiles=l;