"use strict";const e=require("../../untils/common"),r=require("../../untils/logs"),{commandExec:t}=require("../../untils/terminal"),o=async(o,a,s,l)=>{await e.isInstalled("curl")||r.logFatal("Please install curl first");const n=s&&s.pgyer||{},i=n[o.toLocaleLowerCase()];i&&0!==Object.keys(i).length||r.logFatal("Please set your pgy config");const u=i.apiKey||n.apiKey||l.defaultPgyerApiKey,p=i.userKey||n.userKey||l.defaultPgyerUserKey,c=i.buildPassword||n.buildPassword,y=(i.appKey,i.description);u&&p||r.logFatal("Please set your apiKey & userKey of pgy first.");let d=`\n        Start Uploading...\n\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${s.name}\n\n        Your App: ${a}\n\n        `;var g=`curl -F file=@"${a}" -F '_api_key=${u}' -F 'userKey=${p}' `;c&&(g+=`-F 'buildPassword=${c}' `,d+=`\n        Your Build Password: ${c} \n\n        `),y&&(g+=`-F 'buildUpdateDescription=${y}' `,d+=`\n        Your Description: ${y}\n\n        `),g+="https://www.pgyer.com/apiv2/app/upload",r.green(d);try{var w=await t(g)}catch(e){return console.log("exec error result:",w),void r.logFatal(e)}if("string"==typeof w)try{w=JSON.parse(w)}catch(e){console.log("parse error result:",w),r.logFriendly(e)}const f=w&&w.data&&w.data.buildShortcutUrl;if(!f)return void r.logFriendly("Cannot return shortcutUrl: ",w);r.green("\n\n Upload Successful.\n");const m=`https://www.pgyer.com/${f}`;await e.openUrl(m),process.exit(1)};module.exports={pgyerUpload:o};