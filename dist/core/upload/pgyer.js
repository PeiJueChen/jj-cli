"use strict";const e=require("../../untils/common"),o=require("../../untils/logs"),{uploadToPgyer:t,getNextVerion:n,updateInfo:a}=require("../../untils/pgyer-api"),l=async(n,l,r,i,s,c,p)=>{var g,y,u;const d=r&&r.pgyer||{};let f=d[n.toLocaleLowerCase()];if(!c){const t=Object.keys(f);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=f[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),c=await e.askSelectList(n,"Group")}f=c&&f[c],f&&0!==Object.keys(f).length||o.logFatal("Please set your pgy config");const j=f.apiKey||d.apiKey||i.defaultPgyerApiKey,h=(null===(g=f)||void 0===g?void 0:g.buildPassword)||(null==d?void 0:d.buildPassword),v=null===(y=f)||void 0===y?void 0:y.appKey,w=null===(u=f)||void 0===u?void 0:u.channel;j&&v||o.logFatal("Please set your apiKey & appKey of pgy first.");let P=`\n        Start Uploading...\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${r.name}\n\n        Your App: ${l}\n\n        `;h&&(P+=`\n        Your Build Password: ${h} \n\n        `),o.green(P);try{var K=await t(j,l,w,p,c);o.green("\n\nUpload Successful. \n")}catch(e){o.logFatal("\n\n Upload Failure")}try{await a(j,v,h)}catch(e){}!s&&K&&await e.openUrl(K),process.exit(0)},r=async(t,a,l,r)=>{var i;const s=a&&a.pgyer||{};let c=s[t.toLocaleLowerCase()];if(!r){const t=Object.keys(c);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=c[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),r=await e.askSelectList(n,"Group")}c=r&&c[r],c&&0!==Object.keys(c).length||o.logFatal("Please set your pgy config");const p=c.apiKey||s.apiKey||l.defaultPgyerApiKey,g=null===(i=c)||void 0===i?void 0:i.appKey;p&&g||o.logFatal("Please set your apiKey & appKey of pgy first.");try{var y=await n(p,g,r);console.log(y),process.exit(0)}catch(e){process.exit(1)}};module.exports={pgyerUpload:l,getNextVersion:r};