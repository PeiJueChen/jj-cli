"use strict";const e=require("../../untils/common"),o=require("../../untils/logs"),{uploadToPgyer:t,getNextVerion:n,updateInfo:a}=require("../../untils/pgyer-api"),{getSizeByPath:l}=require("../../untils/fs"),i=async(n,i,r,s,c,p,g)=>{var u,y,d,f,v;const j=r&&r.pgyer||{};let h=j[n.toLocaleLowerCase()];if(!p){const t=Object.keys(h);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=h[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),p=await e.askSelectList(n,"Group")}h=(null===(u=h)||void 0===u?void 0:u[`v4${p}`])||(null===(y=h)||void 0===y?void 0:y[`${p}`]),h&&0!==Object.keys(h).length||o.logFatal("Please set your pgy config");const w=h.apiKey||j.apiKey||s.defaultPgyerApiKey,P=(null===(d=h)||void 0===d?void 0:d.buildPassword)||(null==j?void 0:j.buildPassword),F=null===(f=h)||void 0===f?void 0:f.appKey,K=null===(v=h)||void 0===v?void 0:v.channel;w&&F||o.logFatal("Please set your apiKey & appKey of pgy first.");const b=await l(i);let k=`\n        Start Uploading...\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${r.name}\n\n        Your App: ${i}\n\n        Size: ${b}\n\n        `;P&&(k+=`\n        Your Build Password: ${P} \n\n        `),o.green(k);try{var $=await t(w,i,K,g,p);if(!$)return void o.logFatal("\n\n Upload Failure");o.green("\n\nUpload Successful. \n")}catch(e){o.logFatal("\n\n Upload Failure")}try{await a(w,F,P)}catch(e){}!c&&$&&await e.openUrl($),process.exit(0)},r=async(t,a,l,i)=>{var r,s,c;const p=a&&a.pgyer||{};let g=p[t.toLocaleLowerCase()];if(!i){const t=Object.keys(g);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=g[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),i=await e.askSelectList(n,"Group")}g=(null===(r=g)||void 0===r?void 0:r[`v4${i}`])||(null===(s=g)||void 0===s?void 0:s[`${i}`]),g&&0!==Object.keys(g).length||o.logFatal("Please set your pgy config");const u=g.apiKey||p.apiKey||l.defaultPgyerApiKey,y=null===(c=g)||void 0===c?void 0:c.appKey;u&&y||o.logFatal("Please set your apiKey & appKey of pgy first.");try{var d=await n(u,y,i);console.log(d),process.exit(0)}catch(e){process.exit(1)}};module.exports={pgyerUpload:i,getNextVersion:r};