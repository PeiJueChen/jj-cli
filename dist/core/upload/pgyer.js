"use strict";const e=require("../../untils/common"),r=require("../../untils/logs"),{commandExec:t}=require("../../untils/terminal"),a=async(a,o,n,s)=>{await e.isInstalled("curl")||r.logFatal("Please install curl first");const l=n&&n.pgyer||{},i=l[a.toLocaleLowerCase()];i&&0!==Object.keys(i).length||r.logFatal("Please set your pgy config");const u=i.apiKey||l.apiKey||s.defaultPgyerApiKey,p=i.userKey||l.userKey||s.defaultPgyerUserKey,c=i.buildPassword||l.buildPassword,y=(i.appKey,i.description);u&&p||r.logFatal("Please set your apiKey & userKey of pgy first.");let d=`\n        Start Uploading...\n\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${n.name}\n\n        Your App: ${o}\n\n        `;var g=`curl -F 'file=@${o}' -F '_api_key=${u}' -F 'userKey=${p}' `;c&&(g+=`-F 'buildPassword=${c}' `,d+=`\n        Your Build Password: ${c} \n\n        `),y&&(g+=`-F 'buildUpdateDescription=${y}' `,d+=`\n        Your Description: ${y}\n\n        `),g+="https://www.pgyer.com/apiv2/app/upload",r.green(d);try{var w=await t(g)}catch(e){return void r.logFatal(e)}if("string"==typeof w)try{w=JSON.parse(w)}catch(e){throw e}const f=w&&w.data&&w.data.buildShortcutUrl;if(!f)return void r.logFriendly("Cannot return shortcutUrl: ",w);r.green("\n\n Upload Successful.\n");const m=`https://www.pgyer.com/${f}`;await e.openUrl(m)};module.exports={pgyerUpload:a};