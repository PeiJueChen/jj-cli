"use strict";const e=require("../../untils/common"),o=require("../../untils/logs"),{uploadToPgyer:t,getNextVerion:n,updateInfo:a,clearAllVersions:l}=require("../../untils/pgyer-api"),{getSizeByPath:i}=require("../../untils/fs"),r=async(n,l,r,s,c,p,g)=>{var u,y,d,f,v;const j=r&&r.pgyer||{};let h=j[n.toLocaleLowerCase()];if(!p){const t=Object.keys(h);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=h[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),p=await e.askSelectList(n,"Group")}h=(null===(u=h)||void 0===u?void 0:u[`v4${p}`])||(null===(y=h)||void 0===y?void 0:y[`${p}`]),h&&0!==Object.keys(h).length||o.logFatal("Please set your pgy config");const w=h.apiKey||j.apiKey||s.defaultPgyerApiKey,P=(null===(d=h)||void 0===d?void 0:d.buildPassword)||(null==j?void 0:j.buildPassword),F=null===(f=h)||void 0===f?void 0:f.appKey,K=null===(v=h)||void 0===v?void 0:v.channel;w&&F||o.logFatal("Please set your apiKey & appKey of pgy first.");const b=await i(l);let k=`\n        Start Uploading...\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${r.name}\n\n        Your App: ${l}\n\n        Size: ${b}\n\n        `;P&&(k+=`\n        Your Build Password: ${P} \n\n        `),o.green(k);try{var L=await t(r.name,n.toLocaleLowerCase(),w,l,K,g,p);if(!L)return void o.logFatal("\n\n Upload Failure");o.green("\n\nUpload Successful. \n")}catch(e){o.logFatal("\n\n Upload Failure")}try{await a(w,F,P)}catch(e){}!c&&L&&await e.openUrl(L),process.exit(0)},s=async(t,a,i,r)=>{var s,c,p;const g=a&&a.pgyer||{};let u=g[t.toLocaleLowerCase()];if(!r){const t=Object.keys(u);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=u[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),r=await e.askSelectList(n,"Group")}u=(null===(s=u)||void 0===s?void 0:s[`v4${r}`])||(null===(c=u)||void 0===c?void 0:c[`${r}`]),u&&0!==Object.keys(u).length||o.logFatal("Please set your pgy config");const y=u.apiKey||g.apiKey||i.defaultPgyerApiKey,d=null===(p=u)||void 0===p?void 0:p.appKey;y&&d||o.logFatal("Please set your apiKey & appKey of pgy first.");try{l();var f=await n(y,d,r);console.log(f),process.exit(0)}catch(e){process.exit(1)}};module.exports={pgyerUpload:r,getNextVersion:s};