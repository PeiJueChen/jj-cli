"use strict";const e=require("../../untils/common"),o=require("../../untils/logs"),{uploadToPgyer:t,getNextVerion:n,updateInfo:a,clearAllVersions:l}=require("../../untils/pgyer-api"),{getSizeByPath:i}=require("../../untils/fs"),r=async(n,l,r,s,c,p,u)=>{var g,y,d,v,f;const j=r&&r.pgyer||{};let h=j[n.toLocaleLowerCase()];if(!p){const t=Object.keys(h);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=h[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),p=await e.askSelectList(n,"Group")}var w;(h=(null===(g=h)||void 0===g?void 0:g[`v4${p}`])||(null===(y=h)||void 0===y?void 0:y[`${p}`]),h&&0!==Object.keys(h).length||!p.includes("v4"))||(p=p.replace("v4",""),h=null===(w=h)||void 0===w?void 0:w[`${p}`]);h&&0!==Object.keys(h).length||o.logFatal("Please set your pgy config");const P=h.apiKey||j.apiKey||s.defaultPgyerApiKey,b=(null===(d=h)||void 0===d?void 0:d.buildPassword)||(null==j?void 0:j.buildPassword),k=null===(v=h)||void 0===v?void 0:v.appKey,F=null===(f=h)||void 0===f?void 0:f.channel;P&&k||o.logFatal("Please set your apiKey & appKey of pgy first.");const K=await i(l);let $=`\n        Start Uploading...\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${r.name}\n\n        Your App: ${l}\n\n        Size: ${K}\n\n        `;b&&($+=`\n        Your Build Password: ${b} \n\n        `),o.green($);try{var L=await t(r.name,n.toLocaleLowerCase(),P,l,F,u,p);if(!L)return void o.logFatal("\n\n Upload Failure");o.green("\n\nUpload Successful. \n")}catch(e){o.logFatal("\n\n Upload Failure")}try{await a(P,k,b)}catch(e){}!c&&L&&await e.openUrl(L),process.exit(0)},s=async(t,a,i,r)=>{var s,c,p;const u=a&&a.pgyer||{};let g=u[t.toLocaleLowerCase()];if(!r){const t=Object.keys(g);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=g[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),r=await e.askSelectList(n,"Group")}var y;(g=(null===(s=g)||void 0===s?void 0:s[`v4${r}`])||(null===(c=g)||void 0===c?void 0:c[`${r}`]),g&&0!==Object.keys(g).length||!r.includes("v4"))||(r=r.replace("v4",""),g=null===(y=g)||void 0===y?void 0:y[`${r}`]);g&&0!==Object.keys(g).length||o.logFatal("Please set your pgy config");const d=g.apiKey||u.apiKey||i.defaultPgyerApiKey,v=null===(p=g)||void 0===p?void 0:p.appKey;d&&v||o.logFatal("Please set your apiKey & appKey of pgy first.");try{l();var f=await n(d,v,r);console.log(f),process.exit(0)}catch(e){process.exit(1)}};module.exports={pgyerUpload:r,getNextVersion:s};