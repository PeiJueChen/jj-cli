"use strict";const e=require("../../untils/common"),o=require("../../untils/logs"),{uploadToPgyer:t,getNextVerion:n,updateInfo:a}=require("../../untils/pgyer-api"),l=async(n,l,i,r,s,c,p)=>{var g,u,y,d,f;const v=i&&i.pgyer||{};let j=v[n.toLocaleLowerCase()];if(!c){const t=Object.keys(j);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=j[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),c=await e.askSelectList(n,"Group")}j=(null===(g=j)||void 0===g?void 0:g[`v4${c}`])||(null===(u=j)||void 0===u?void 0:u[`${c}`]),j&&0!==Object.keys(j).length||o.logFatal("Please set your pgy config");const h=j.apiKey||v.apiKey||r.defaultPgyerApiKey,w=(null===(y=j)||void 0===y?void 0:y.buildPassword)||(null==v?void 0:v.buildPassword),P=null===(d=j)||void 0===d?void 0:d.appKey,F=null===(f=j)||void 0===f?void 0:f.channel;h&&P||o.logFatal("Please set your apiKey & appKey of pgy first.");let K=`\n        Start Uploading...\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${i.name}\n\n        Your App: ${l}\n\n        `;w&&(K+=`\n        Your Build Password: ${w} \n\n        `),o.green(K);try{var b=await t(h,l,F,p,c);if(!b)return void o.logFatal("\n\n Upload Failure");o.green("\n\nUpload Successful. \n")}catch(e){o.logFatal("\n\n Upload Failure")}try{await a(h,P,w)}catch(e){}!s&&b&&await e.openUrl(b),process.exit(0)},i=async(t,a,l,i)=>{var r,s,c;const p=a&&a.pgyer||{};let g=p[t.toLocaleLowerCase()];if(!i){const t=Object.keys(g);if(0===t.length)return void o.logFatal("Cannot find your appcenter config at jj.config.json");const n=t.filter((e=>{const o=g[e];return"object"==typeof o&&Object.keys(o).length>0}));0===n.length&&o.logFatal("Please check your jj.config.json, Cannot find pgyer group"),i=await e.askSelectList(n,"Group")}g=(null===(r=g)||void 0===r?void 0:r[`v4${i}`])||(null===(s=g)||void 0===s?void 0:s[`${i}`]),g&&0!==Object.keys(g).length||o.logFatal("Please set your pgy config");const u=g.apiKey||p.apiKey||l.defaultPgyerApiKey,y=null===(c=g)||void 0===c?void 0:c.appKey;u&&y||o.logFatal("Please set your apiKey & appKey of pgy first.");try{var d=await n(u,y,i);console.log(d),process.exit(0)}catch(e){process.exit(1)}};module.exports={pgyerUpload:l,getNextVersion:i};