"use strict";const e=require("../../untils/common"),r=require("../../untils/logs"),{commandExec:t}=require("../../untils/terminal"),o=async(o,a,s,l,n)=>{await e.isInstalled("curl")||r.logFatal("Please install curl first");const i=s&&s.pgyer||{},u=i[o.toLocaleLowerCase()];u&&0!==Object.keys(u).length||r.logFatal("Please set your pgy config");const p=u.apiKey||i.apiKey||l.defaultPgyerApiKey,c=u.userKey||i.userKey||l.defaultPgyerUserKey,y=u.buildPassword||i.buildPassword,d=(u.appKey,u.description);p&&c||r.logFatal("Please set your apiKey & userKey of pgy first.");let g=`\n        Start Uploading...\n\n\n        Upload To "pgy": (https://www.pgyer.com)\n\n        Your Project name: ${s.name}\n\n        Your App: ${a}\n\n        `;var w=`curl -F file=@"${a}" -F '_api_key=${p}' -F 'userKey=${c}' `;y&&(w+=`-F 'buildPassword=${y}' `,g+=`\n        Your Build Password: ${y} \n\n        `),d&&(w+=`-F 'buildUpdateDescription=${d}' `,g+=`\n        Your Description: ${d}\n\n        `),w+="https://www.pgyer.com/apiv2/app/upload",r.green(g);try{var f=await t(w)}catch(e){return console.log("exec error result:",f),void r.logFatal(e)}if("string"==typeof f)try{f=JSON.parse(f)}catch(e){console.log("parse error result:",f),r.logFriendly(e)}const m=f&&f.data&&f.data.buildShortcutUrl;if(!m)return void r.logFriendly("Cannot return shortcutUrl: ",f);r.green("\n\n Upload Successful.\n");const F=`https://www.pgyer.com/${m}`;n||await e.openUrl(F),process.exit(1)};module.exports={pgyerUpload:o};