"use strict";const e=require("../../untils/logs"),a=require("../../untils/common"),{platforms:t}=require("../../constants/platforms"),o=require("../../untils/parse-config"),r=async(r,n,l)=>{const s=r&&r.toLowerCase().trim();var i=t[s];if(!i){let o=await a.askPlatform();if(!(i=t[o]))return void e.logFatal(`Only support ${t} now.`)}const{config:p,configPathDiretory:c}=await o.parseConfigPromise(n);try{var u=await o.askProjects(p,null)}catch(a){e.logFatal("Please write all `project` field as project name")}if(!u)return void e.logFatal("Please write all `project` field as project name");var g=(null==u?void 0:u.pgyer)||(null==u?void 0:u.appcenter);l&&(g=null==u?void 0:u.appcenter);const m=!(null==u||!u.pgyer);if(!g)return void e.logFatal("missing appcenter or pgyer");const f=g[i];if(!f)return void e.logFatal("missing appInfo");const d=Object.keys(f).filter((e=>{const a=f[e],t="object"==typeof a&&Object.keys(a).length>0;return m?t:t&&a.userName&&a.appName&&a.group}));0===d.length&&e.logFatal("Please check your jj.config.json, Cannot find userName/appName/group");var v=await a.askSelectList(d,"Group");const j=f[v],y=null==j?void 0:j.channel;if(m&&y){var h=`app/${u.name}?env=${v}&platform=${i}`,w=`https://pgyer-enhance.web.app/${encodeURIComponent(h)}`;if(!y)return void e.logFatal("missing channel")}else{j.userName&&j.appName&&j.group||e.logFatal("Please check your jj.config.json, Cannot find userName/appName/group"),w=`https://install.appcenter.ms/users/${j.userName}/apps/${j.appName}/distribution_groups/${j.group}`}e.logFriendly("Your app link: "+w),await a.openUrl(w)};module.exports={applink:r};